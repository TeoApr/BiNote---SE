<!-- Note Preview Modal -->
<div id="notePreviewModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="previewTitle">Note Preview</h3>
            <span class="close" onclick="closeModal('notePreviewModal')">&times;</span>
        </div>
        <div class="preview-content">
            <div class="preview-image">
                <div id="previewImagePlaceholder">üìÑ</div>
            </div>
            <div class="preview-details">
                <div class="rating" id="previewRating"></div>
                <h4 id="previewNoteTitle"></h4>
                <p id="previewAuthor"></p>
                <p id="previewDescription"></p>
                <div class="preview-price" id="previewPrice"></div>
                <div class="preview-features">
                    <h5>Consists of (<span id="previewPages"></span> pages):</h5>
                    <ul id="previewFeatures"></ul>
                </div>
                <div class="preview-actions">
                    <button class="btn btn-outline" onclick="addToCart(Notes.currentPreviewNote?.id)">Add to Cart</button>
                    <button class="btn btn-primary" onclick="buyNow(Notes.currentPreviewNote?.id)">Purchase Now</button>
                    <button class="btn btn-secondary" onclick="openNotePreview(Notes.currentPreviewNote?.id)">üëÅÔ∏è Preview Pages</button>
                </div>
            </div>
        </div>
        <div class="reviews-section">
            <h4>Reviews & Comments</h4>
            <div id="previewReviews"></div>
        </div>
    </div>
</div>

<!-- Note Preview Viewer Modal -->
<div id="notePreviewViewerModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="previewViewerTitle">Preview - Limited Access</h3>
            <span class="close" onclick="closeModal('notePreviewViewerModal')">&times;</span>
        </div>
        
        <div class="preview-viewer-container">
            <div class="preview-notice">
                <div class="notice-header">
                    <div class="notice-icon">üëÅÔ∏è</div>
                    <div class="notice-text">
                        <h4>Preview Mode</h4>
                        <p>You can view sample pages to help with your purchase decision</p>
                    </div>
                    <div class="notice-actions">
                        <button class="btn btn-primary btn-sm" onclick="buyNow(Notes.currentPreviewNote?.id)">Purchase Full Access</button>
                    </div>
                </div>
            </div>

            <div class="preview-limitations">
                <div class="limitation-item">
                    <span class="limit-icon">üìñ</span>
                    <span>Preview: 3 of 20 pages</span>
                </div>
                <div class="limitation-item">
                    <span class="limit-icon">‚è∞</span>
                    <span>Time limit: <span id="previewTimeLeft">5:00</span></span>
                </div>
                <div class="limitation-item">
                    <span class="limit-icon">üîí</span>
                    <span>Watermarked preview content</span>
                </div>
            </div>

            <div class="preview-document-viewer">
                <div class="preview-watermark">PREVIEW</div>
                <div id="previewDocumentContent" class="preview-content-area">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>

            <div class="preview-page-controls">
                <button class="page-nav-btn" id="previewPrevBtn" onclick="previousPreviewPage()" disabled>‚Üê Previous</button>
                <span class="page-info" id="previewPageInfo">Page 1 of 3</span>
                <button class="page-nav-btn" id="previewNextBtn" onclick="nextPreviewPage()">Next ‚Üí</button>
            </div>

            <div class="preview-purchase-prompt">
                <div class="purchase-card">
                    <h4>Want to see the complete 20 pages?</h4>
                    <p>Get full access to all content, examples, and solutions</p>
                    <div class="purchase-benefits">
                        <div class="benefit-item">‚úÖ All 20 pages</div>
                        <div class="benefit-item">‚úÖ High-quality content</div>
                        <div class="benefit-item">‚úÖ Practice problems & solutions</div>
                        <div class="benefit-item">‚úÖ Lifetime access</div>
                    </div>
                    <div class="purchase-actions">
                        <div class="price-display">Rp 19,999</div>
                        <button class="btn btn-primary btn-lg" onclick="buyNow(Notes.currentPreviewNote?.id)">Purchase Now</button>
                        <button class="btn btn-outline" onclick="addToCart(Notes.currentPreviewNote?.id)">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Checkout Modal -->
<div id="checkoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Select Payment Method</h3>
            <span class="close" onclick="closeModal('checkoutModal')">&times;</span>
        </div>
        <div class="checkout-content">
            <div class="billing-info">
                <h4>Billing Address</h4>
                <p id="billingAddress">AFYAD7VAKSDF823RH238SDSI</p>
            </div>
            
            <div class="payment-section">
                <h4>How would you like to pay?</h4>
                <div class="payment-methods">
                    <div class="payment-method" onclick="selectPaymentMethod('qris')">
                        <input type="radio" name="payment" value="qris">
                        <span>üî≤ Pay with QRIS</span>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('ovo')">
                        <input type="radio" name="payment" value="ovo">
                        <span>üü£ Pay with OVO</span>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('gopay')">
                        <input type="radio" name="payment" value="gopay">
                        <span>üü¢ Pay with GOPAY</span>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('dana')">
                        <input type="radio" name="payment" value="dana">
                        <span>üîµ Pay with DANA</span>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('shopeepay')">
                        <input type="radio" name="payment" value="shopeepay">
                        <span>üü† Pay with ShopeePay</span>
                    </div>
                </div>
            </div>

            <div class="checkout-summary">
                <h4>Order Summary</h4>
                <div class="timer">Your Items Are Being Reserved For <span id="countdown">30:00</span></div>
                <div id="checkoutItems"></div>
                <div class="checkout-totals">
                    <div class="summary-line">
                        <span>Subtotal:</span>
                        <span id="checkoutSubtotal">Rp 0</span>
                    </div>
                    <div class="summary-line">
                        <span>Admin Fee:</span>
                        <span>Rp 1,500</span>
                    </div>
                    <div class="summary-line">
                        <span>Tax (5%):</span>
                        <span id="checkoutTax">Rp 0</span>
                    </div>
                    <div class="summary-line total">
                        <span>TOTAL:</span>
                        <span id="checkoutTotal">Rp 0</span>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="processPayment()" id="payNowBtn" disabled>Pay Now</button>
            </div>
        </div>
    </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Login</h3>
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" name="password" placeholder="Enter your password" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            <p style="text-align: center; margin-top: 1rem;">
                Don't have account? <a href="#" onclick="closeModal('loginModal'); showModal('registerModal');">Register here!</a>
            </p>
        </form>
    </div>
</div>

<!-- Register Modal -->
<div id="registerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Register</h3>
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
        </div>
        <form id="registerForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" name="firstName" placeholder="Enter your first name" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" name="lastName" placeholder="Enter your last name" required>
                </div>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" placeholder="Enter your email" required>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" placeholder="Enter your password" minlength="6" required>
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" name="confirmPassword" placeholder="Confirm your password" required>
                </div>
            </div>
            <div class="form-group">
                <label>Educational Institution</label>
                <input type="text" name="institution" placeholder="Enter your institution" required>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>Major</label>
                    <input type="text" name="major" placeholder="Enter your major" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" name="phone" placeholder="Enter your phone number" required>
                </div>
            </div>
            <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" name="birthDate" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Sign Up</button>
            <p style="text-align: center; margin-top: 1rem;">
                Already have an account? <a href="#" onclick="closeModal('registerModal'); showModal('loginModal');">Login here!</a>
            </p>
        </form>
    </div>
</div>

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Profile</h3>
            <span class="close" onclick="closeModal('editProfileModal')">&times;</span>
        </div>
        <form id="editProfileForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" name="firstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" name="lastName" required>
                </div>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" required>
            </div>
            <div class="form-group">
                <label>Educational Institution</label>
                <input type="text" name="institution" required>
            </div>
            <div class="form-group">
                <label>Major</label>
                <input type="text" name="major" required>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea name="description" rows="3" placeholder="Tell us about yourself..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Save Changes</button>
        </form>
    </div>
</div>

<!-- Change Password Modal -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Password</h3>
            <span class="close" onclick="closeModal('changePasswordModal')">&times;</span>
        </div>
        <form id="changePasswordForm">
            <div class="form-group">
                <label>Current Password</label>
                <input type="password" name="currentPassword" required>
            </div>
            <div class="form-group">
                <label>New Password</label>
                <input type="password" name="newPassword" minlength="6" required>
            </div>
            <div class="form-group">
                <label>Confirm New Password</label>
                <input type="password" name="confirmNewPassword" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Change Password</button>
        </form>
    </div>
</div>

<!-- Note Viewer Modal (Protected) -->
<div id="noteViewerModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="viewerTitle">Protected Document Viewer</h3>
            <span class="close" onclick="closeSecureViewer()">&times;</span>
        </div>
        
        <div class="secure-note-viewer protected-content no-screenshot">
            <div class="security-header">
                <div class="security-icon">üîí</div>
                <div class="security-text">
                    <h4>Document Protection Active</h4>
                    <p>This document is protected against unauthorized copying and distribution</p>
                </div>
                <div class="security-icon">üëÅÔ∏è</div>
            </div>

            <div class="time-limit-warning">
                <p>‚è∞ Viewing session expires in: <span class="timer" id="viewingTimer">15:00</span></p>
                <p><small>Document will automatically close when timer reaches zero</small></p>
            </div>

            <div class="protected-viewer">
                <div class="watermark" id="documentWatermark"></div>
                <div id="documentContent" class="protected-content">
                    <!-- Document content will be loaded here -->
                </div>
            </div>

            <div class="page-controls">
                <button class="page-nav-btn" id="prevPageBtn" onclick="previousPage()" disabled>‚Üê Previous</button>
                <span class="page-info" id="pageInfo">Page 1 of 20</span>
                <button class="page-nav-btn" id="nextPageBtn" onclick="nextPage()">Next ‚Üí</button>
            </div>

            <div class="viewer-actions" style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-outline" onclick="closeSecureViewer()">Close Viewer</button>
                <button class="btn btn-secondary" onclick="reportIssue()">Report Issue</button>
            </div>
        </div>
    </div>
</div>

<!-- QRIS Payment Modal -->
<div id="qrisModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Pay with QRIS</h3>
            <span class="close" onclick="closeModal('qrisModal')">&times;</span>
        </div>
        <div class="qris-content">
            <div class="qris-header">
                <div class="qris-logo">
                    <h2>QRIS</h2>
                    <p>Quick Response Code Indonesian Standard</p>
                </div>
                <div class="payment-amount">
                    <h3 id="qrisAmount">Rp 22,574</h3>
                    <p>BINotes</p>
                </div>
            </div>
            
            <div class="qris-code">
                <div class="qr-container">
                    <div id="qrcode">
                        <!-- QR Code will be generated here -->
                        <div class="qr-pattern"></div>
                    </div>
                </div>
                <p class="qris-instruction">Scan this QR code with any QRIS-compatible app</p>
            </div>

            <div class="qris-apps">
                <h4>Compatible Apps:</h4>
                <div class="app-icons">
                    <div class="app-icon">üü£ OVO</div>
                    <div class="app-icon">üü¢ GoPay</div>
                    <div class="app-icon">üîµ DANA</div>
                    <div class="app-icon">üü† ShopeePay</div>
                    <div class="app-icon">üè¶ Bank Apps</div>
                </div>
            </div>

            <div class="qris-status">
                <div class="status-indicator" id="qrisStatus">
                    <div class="loading-spinner"></div>
                    <p>Waiting for payment...</p>
                </div>
                <div class="qris-timer">
                    <p>Payment expires in: <span id="qrisCountdown">10:00</span></p>
                </div>
            </div>

            <div class="qris-actions">
                <button class="btn btn-outline" onclick="closeModal('qrisModal')">Cancel Payment</button>
                <button class="btn btn-secondary" onclick="refreshQRIS()">Refresh QR Code</button>
            </div>
        </div>
    </div>
</div>